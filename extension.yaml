name: pushfire-subscribers-sync
version: 0.0.1
specVersion: v1beta

displayName: Pushfire Subscribers Sync
description: Syncs subscribers from Firestore to Pushfire.

icon: icon.png

author:
  authorName: Pushfire, a product of Flywheel Studio
  url: https://pushfire.app

contributors:
  - authorName: Flywheel Studio
    url: https://github.com/FlywheelStudio

sourceUrl: https://github.com/FlywheelStudio/pushfire-libs-firebase-extension
billingRequired: true

license: apache-2.0

roles:
  - role: firestore.stdout
    reason: Allows the extension to read from Firestore.

resources:
  - name: updateSubscriber
    type: firebaseextensions.v1beta.function
    description: Updates a subscriber in Pushfire when their Firestore document is updated.
    properties:
      eventTrigger:
        eventType: providers/cloud.firestore/eventTypes/document.update
        resource: "projects/{PROJECT_ID}/databases/(default)/documents/${param:PUSHFIRE_MATCHING_COLLECTION}/{documentId}"
      runtime: nodejs18
      source: functions

params:
  - param: PUSHFIRE_PROJECT_ID
    label: Pushfire Project ID
    description: The ID of the Pushfire project to sync subscribers from.
    type: string
    required: true
    immutable: true

  - param: PUSHFIRE_PROJECT_TOKEN
    label: Pushfire Project Token
    description: The API token for your Pushfire project.
    type: secret
    required: true
    immutable: true

  - param: PUSHFIRE_MATCHING_COLLECTION
    label: Matching collection name
    description: The name of the Firestore collection that contains the subscriber documents.
    type: string
    required: true
    immutable: false

  - param: PUSHFIRE_MATCHING_TOKEN_JSON_SCHEMA_CONFIGURATION
    label: Matching JSON Schema Configuration
    description: >
      **⚠️IMPORTANT:** Use the [PushFire Schema Builder](https://pushfire.app/extensions/firebase/schema-builder) to create your field mapping. Copy the JSON configuration it generates and paste it here. 
      This configuration allows you to map your Firestore fields to Pushfire fields. The URL above makes it easy to configure, preview, and generate the required mapping JSON.
    type: string
    required: true
    immutable: false
